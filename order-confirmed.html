<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Order Confirmed - AlSaji Auto Parts</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<script src="js/utils/pathHelper.js"></script>

  <script src="data/static_api.js"></script>
    <script src="js/main.js"></script>
  <script src="js/api.js"></script>
  <script src="js/cart-manager.js"></script>
    <script src="js/layout.js"></script>




  <main class="wrap" style="text-align:center;padding:60px 20px">
    <div style="max-width:500px;margin:0 auto">
      <div style="font-size:64px;margin-bottom:20px">âœ…</div>
      <h1 style="margin-bottom:12px;color:var(--green)">Order Confirmed!</h1>
      <p class="muted" style="margin-bottom:24px">
        Thank you for your order. We've received your order and will process it shortly.
      </p>

      <div class="card" style="text-align:left;margin-bottom:24px">
        <h3>Order Details</h3>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">Order Number:</div>
          <div id="orderNumber" style="font-weight:600;color:var(--primary)"></div>
        </div>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">Order Date:</div>
          <div id="orderDate"></div>
        </div>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">Estimated Delivery:</div>
          <div style="color:var(--green);font-weight:500">2-3 business days</div>
        </div>
        <div class="row between">
          <div class="muted">Total Amount:</div>
          <div id="orderTotal" style="font-weight:600;color:var(--red)"></div>
        </div>
      </div>

      <div class="card" style="text-align:left;margin-bottom:24px;background:var(--w2)">
        <h4 style="margin-bottom:12px">What's Next?</h4>
        <div style="display:flex;gap:12px;align-items:flex-start;margin-bottom:12px">
          <div style="background:var(--green);color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">1</div>
          <div>
            <div style="font-weight:500">Order Processing</div>
            <div class="muted" style="font-size:14px">We'll prepare your items for shipping</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;margin-bottom:12px">
          <div style="background:var(--w3);color:var(--text);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">2</div>
          <div>
            <div style="font-weight:500">Shipping</div>
            <div class="muted" style="font-size:14px">Your order will be shipped within 24 hours</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="background:var(--w3);color:var(--text);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">3</div>
          <div>
            <div style="font-weight:500">Delivery</div>
            <div class="muted" style="font-size:14px">You'll receive your order in 2-3 business days</div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <a href="shop.html" class="btn">Continue Shopping</a>
        <a href="index.html" class="btn secondary">Back to Home</a>
        <button class="btn secondary" onclick="printOrder()">Print Receipt</button>
      </div>

      <div style="margin-top:32px;padding:16px;background:var(--w2);border-radius:8px;">
        <p class="muted" style="margin:0;font-size:14px">
          Need help? <a href="support.html" style="color:var(--primary)">Contact our support team</a> or call us at <strong>+964 123 456 7890</strong>
        </p>
      </div>
    </div>
  </main>

  <script>
  class OrderConfirmation {
      constructor() {
          this.init();
      }

      init() {
          console.log('âœ… Initializing order confirmation...');
          this.loadOrderDetails();
          this.updateCartCount();
          this.saveOrderToHistory();
      }

    // In order-confirmed.html, add this to loadOrderDetails method:
loadOrderDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const orderId = urlParams.get('order');
    const total = urlParams.get('total');
    const odooId = urlParams.get('odoo_id');

    // Set order number
    document.getElementById('orderNumber').textContent = orderId;

    // ðŸ”¥ SET ORDER DATE (current date)
    const orderDate = new Date();
    const formattedDate = orderDate.toLocaleDateString('en-UK', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',

    });

    // Find or create order date element
    let orderDateElement = document.getElementById('orderDate');
    if (!orderDateElement) {
        // If element doesn't exist, create it
        const orderNumberElement = document.getElementById('orderNumber');
        if (orderNumberElement && orderNumberElement.parentNode) {
            orderDateElement = document.createElement('div');
            orderDateElement.id = 'orderDate';
            orderDateElement.className = 'order-date';
            orderDateElement.style.marginTop = '8px';
            orderDateElement.style.color = 'var(--muted)';
            orderNumberElement.parentNode.insertBefore(orderDateElement, orderNumberElement.nextSibling);
        }
    }
    if (orderDateElement) {
        orderDateElement.textContent = `${formattedDate}`;
    }

    // ðŸ”¥ SET TOTAL AMOUNT
    if (total) {
        // Find or create total amount element
        let totalElement = document.getElementById('orderTotal');
        if (!totalElement) {
            const orderNumberElement = document.getElementById('orderNumber');
            if (orderNumberElement && orderNumberElement.parentNode) {
                totalElement = document.createElement('div');
                totalElement.id = 'orderTotal';
                totalElement.className = 'order-total';
                totalElement.style.marginTop = '8px';
                totalElement.style.fontSize = '1.2em';
                totalElement.style.fontWeight = 'bold';
                totalElement.style.color = 'var(--red)';
                const orderDateEl = document.getElementById('orderDate');
                if (orderDateEl) {
                    orderDateEl.parentNode.insertBefore(totalElement, orderDateEl.nextSibling);
                } else {
                    orderNumberElement.parentNode.insertBefore(totalElement, orderNumberElement.nextSibling);
                }
            }
        }
        if (totalElement) {
            totalElement.textContent = ` IQD ${parseInt(total).toLocaleString()}`;
        }
    }

    // Show Odoo status if available
    if (odooId && odooId !== 'manual') {
        console.log(`âœ… Order synced to Odoo with ID: ${odooId}`);
        // You can add Odoo status display here if needed
    }

}

      saveOrderToHistory() {
          // Save order to order history
          const orderNumber = document.getElementById('orderNumber').textContent;
          const orderTotal = document.getElementById('orderTotal').textContent;

          const orderData = {
              id: orderNumber,
              date: new Date().toISOString(),
              total: this.extractAmount(orderTotal),
              status: 'confirmed'
          };

          // Save to localStorage
          localStorage.setItem('alsaji_last_order', JSON.stringify(orderData));

          // Add to order history
          let orderHistory = JSON.parse(localStorage.getItem('alsaji_order_history') || '[]');
          orderHistory.unshift(orderData);
          localStorage.setItem('alsaji_order_history', JSON.stringify(orderHistory.slice(0, 10))); // Keep last 10 orders
      }

      extractAmount(amountText) {
          // Extract numeric value from "IQD 1,234" format
          const match = amountText.match(/IQD\s*([\d,]+)/);
          if (match) {
              return parseInt(match[1].replace(/,/g, ''));
          }
          return 0;
      }

      async updateCartCount() {
          try {
              // Reset cart count to 0 since order is confirmed
              const cartCountElement = document.getElementById('cartCount');
              if (cartCountElement) {
                  cartCountElement.textContent = '0';
              }

              // Also clear the cart in localStorage to be sure
              localStorage.removeItem('alsaji_cart');

          } catch (error) {
              console.error('Failed to update cart count:', error);
          }
      }
  }

  function printOrder() {
      const orderContent = `
          <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 500px; margin: 0 auto;">
              <div style="text-align: center; margin-bottom: 20px;">
                  <h1 style="color: #2c5aa0; margin-bottom: 8px;">AlSaji Auto Parts</h1>
                  <p style="color: #666; margin: 0;">Order Confirmation</p>
              </div>

              <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>Order Number:</strong>
                      <span>${document.getElementById('orderNumber').textContent}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>Order Date:</strong>
                      <span>${document.getElementById('orderDate').textContent}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>Delivery Estimate:</strong>
                      <span>2-3 business days</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 18px;">
                      <strong>Total Amount:</strong>
                      <span style="color: #dc3545;">${document.getElementById('orderTotal').textContent}</span>
                  </div>
              </div>

              <div style="text-align: center; color: #666; font-size: 14px;">
                  <p>Thank you for your order!</p>
                  <p>AlSaji Auto Parts - Quality Parts, Trusted Service</p>
              </div>
          </div>
      `;

      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
          <html>
              <head>
                  <title>Order Confirmation - ${document.getElementById('orderNumber').textContent}</title>
                  <style>
                      body { font-family: Arial, sans-serif; margin: 20px; }
                      @media print {
                          body { margin: 0; }
                      }
                  </style>
              </head>
              <body>${orderContent}</body>
          </html>
      `);
      printWindow.document.close();
      printWindow.focus();

      setTimeout(() => {
          printWindow.print();
          printWindow.close();
      }, 250);
  }

  // Initialize order confirmation
  document.addEventListener('DOMContentLoaded', () => {
      new OrderConfirmation();
  });
  </script>

</body>
</html>