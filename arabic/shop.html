<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>المتجر - الساجي لقطع غيار السيارات</title>
  <link type="image/x-icon" rel="shortcut icon" href="/assets/ALSAJI B2B.svg">
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="css/style-ar.css">
  <link rel="preload" href="../css/style.css" as="style">
  <link rel="preload" href="../js/shop.js" as="script">
</head>
<body style="visibility:hidden;">
<script src="../js/utils/pathHelper.js"></script>

  <script src="../js/main.js"></script>
  <script src="../data/static_api.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/shop.js"></script>
  <script src="../js/mobile-filters.js"></script>
  <script src="../js/shop-ui.js"></script> <!-- NEW: Added this file -->
  <script src="../js/cart-manager.js"></script>
  <script src="../js/vehicle-manager.js"></script>
  <script src="../data/json/vehicle_compatibility_index.js"></script>



  <main class="wrap">
    <div class="grid shop">
      <!-- Desktop Filters (hidden on mobile) -->
      <aside class="card" id="desktopFilters">
        <div style="display: flex; flex-direction: column; gap: 4px; padding: 8px 8px">
          <div class="muted" id="resultsCount">جاري تحميل المنتجات...</div>
          <h2 class="bold" style="margin: 0">مركبتك</h2>
        </div>
        <div id="vehBox" class="card" style="background:#f9f7f9">
          <div class="muted">لم يتم اختيار مركبة</div>
        </div>
        <div class="row between" style="align-items: center; padding: 8px 8px">
          <h2 style="margin: 0 0 0 0;">الفلاتر</h2>
          <button class="btn clear-filters" style="white-space: nowrap;" id="clearButton">
            مسح الكل
          </button>
        </div>
        <div class="card">
          <div class="muted">الماركة</div>
          <select class="select" id="filterBrand">
            <option value="">كل الماركات</option>
          </select>
        </div>
        <div class="card" style="margin-top:8px">
          <div class="muted">الفئة</div>
          <select class="select" id="filterCategory">
            <option value="">كل الفئات</option>
          </select>
        </div>
        <div class="card" style="margin-top:8px">
          <div class="muted">نطاق السعر</div>
          <select class="select" id="filterPrice">
            <option value="">أي سعر</option>
            <option value="0-50000">أقل من 50,000 دينار</option>
            <option value="50000-100000">50,000 - 100,000 دينار</option>
            <option value="100000-200000">100,000 - 200,000 دينار</option>
            <option value="200000-9999999">أكثر من 200,000 دينار</option>
          </select>
        </div>
        <div class="card" style="margin-top:8px">
          <div class="muted">التوفر</div>
          <select class="select" id="filterStock">
            <option value="">أي حالة مخزون</option>
            <option value="True">متوفر</option>
            <option value="False">غير متوفر</option>
          </select>
        </div>
      </aside>

      <!-- Main Content Area -->
      <section style="flex: 1; min-width: 0;">
        <!-- Shop Header -->
        <div class="shop-header" style="margin-bottom: 16px;">
          <!-- Desktop Search & Sort -->
          <div class="desktop-search-sort row between" style="align-items: center; gap: 6px;">
            <div class="search" style="flex: 1; display: flex; align-items: center; min-width: 0;">
              <input class="search input" id="searchInput" placeholder="Search products..." style="flex: 1; min-width: 520px; padding: 10px 12px;  border-radius: 8px;">
              <button class="btn" id="searchButton" style="margin-left: 8px; white-space: nowrap;">بحث</button>
            </div>
            <div class="desktop-sort" style="flex-shrink: 0;">
              <select class="select" id="desktopSortSelect">
                <option value="relevance">الأكثر صلة</option>
                <option value="price-low">السعر: من الأقل للأعلى</option>
                <option value="price-high">السعر: من الأعلى للأقل</option>
                <option value="newest">الأحدث</option>
              </select>
            </div>
          </div>

          <!-- Mobile Search & Filter Row -->
          <div class="mobile-search-sort" id="mobileSearchSort" style="display: none;">
            <!-- Mobile Search Bar -->
            <div class="mobile-search-container" id="mobileSearchContainer" style="display: none; margin-bottom: 12px;">
              <div class="search" style="display: flex; align-items: center; width: 100%; background: white; border: 1px solid var(--w1); border-radius: 8px; padding: 4px;">
                <input type="text" id="mobileSearchInput" placeholder="ابحث في المنتجات..." style="flex: 1; border: none; outline: none; padding: 8px 12px; background: transparent;">
                <button class="btn-text" id="mobileSearchClose" style="padding: 8px; color: #666;">✕</button>
              </div>
            </div>

            <!-- Mobile Controls Row -->
            <div class="wrap">
              <div class="mobile-controls-row row between" style="align-items: center; gap: 8px;">
                <!-- Filter & Sort Buttons -->
                <div class="mobile-buttons" style="display: flex; gap: 8px; flex-shrink: 0;">
                  <button class="btn2" id="mobileFilterBtn" style="white-space: nowrap; min-width: 80px;">
                    الفلاتر
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Grid -->
        <div id="productGrid" class="grid plp">
          <!-- Loading skeleton -->
          <div class="loading-skeleton" style="display: none;">
            <div class="card">
              <div class="image loading"></div>
              <div class="muted loading"></div>
              <div style="font-weight:500;margin:8px 0" class="loading"></div>
              <div class="row between">
                <div class="loading"></div>
                <button class="btn loading" disabled>جاري التحميل</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Load More Button -->
        <div id="loadMoreContainer" style="text-align: center; margin-top: 24px; display: none;">
          <button class="btn secondary" id="loadMoreBtn">
            تحميل المزيد من المنتجات
          </button>
          <div id="loadMoreInfo" class="muted" style="margin-top: 8px; font-size: 14px;"></div>
        </div>
      </section>
    </div>
  </main>

  <!-- Mobile Filter Bottom Sheet -->
  <div class="mobile-filter-sheet" id="mobileFilterSheet">
    <div class="filter-overlay" id="filterOverlay"></div>
    <div class="filter-sheet-content">
      <!-- Header -->
      <div class="filter-header">
        <h3 style="margin: 0;">الفلاتر</h3>
        <button class="filter-close" id="filterClose">
          <i style="font-size: 20px;">×</i>
        </button>
      </div>

      <!-- Filter Content -->
      <div class="filter-content">
        <!-- Vehicle Filter Section -->
        <div class="filter-section">
          <button class="section-title" data-section="vehicle">
            المركبة
            <svg class="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M9.00019 8.49997C8.86858 8.50073 8.73812 8.4755 8.61628 8.42574C8.49444 8.37597 8.38363 8.30265 8.29019 8.20997L6.00019 5.90997L3.71019 8.20997C3.52188 8.39827 3.26649 8.50406 3.00019 8.50406C2.73388 8.50406 2.47849 8.39827 2.29019 8.20997C2.10188 8.02166 1.99609 7.76627 1.99609 7.49997C1.99609 7.23366 2.10188 6.97827 2.29019 6.78997L6.00019 3.08997L9.71019 6.78997C9.80391 6.88293 9.87831 6.99353 9.92908 7.11539C9.97985 7.23725 10.006 7.36795 10.006 7.49997C10.006 7.63198 9.97985 7.76268 9.92908 7.88454C9.87831 8.0064 9.80391 8.117 9.71019 8.20997C9.61675 8.30265 9.50593 8.37597 9.38409 8.42574C9.26225 8.4755 9.13179 8.50073 9.00019 8.49997Z"></path>
            </svg>
          </button>
          <div class="section-body" id="vehicleSection">
            <div class="vehicle-filter-content">
              <!-- Current Vehicle Display -->
              <div id="mobileCurrentVehicle" class="current-vehicle-display" style="display: none;">
                <div class="row between" style="align-items: center; margin-bottom: 12px; padding: 8px; background: #f0f9ff; border-radius: 8px;">
                  <div>
                    <strong id="mobileCurrentVehicleText">المركبة الحالية</strong>
                    <div class="muted" style="font-size: 12px;">جاري التصفية لهذه المركبة</div>
                  </div>
                  <button class="btn secondary" id="mobileClearVehicle" style="padding: 4px 8px; font-size: 12px;">
                    مسح
                  </button>
                </div>
              </div>

              <!-- Vehicle Selection Form -->
              <div class="vehicle-selection-form">
                <div class="form-group">
                  <label class="muted" style="display: block; margin-bottom: 4px; font-size: 14px;">الشركة المصنعة</label>
                  <select class="select" id="mobileVehicleMake" style="width: 100%;">
                    <option value="">اختر الشركة المصنعة</option>
                  </select>
                </div>

                <div class="form-group" style="margin-top: 12px;">
                  <label class="muted" style="display: block; margin-bottom: 4px; font-size: 14px;">الموديل</label>
                  <select class="select" id="mobileVehicleModel" style="width: 100%;" disabled>
                    <option value="">اختر الموديل</option>
                  </select>
                </div>

                <div class="form-group" style="margin-top: 12px;">
                  <label class="muted" style="display: block; margin-bottom: 4px; font-size: 14px;">السنة</label>
                  <select class="select" id="mobileVehicleYear" style="width: 100%;" disabled>
                    <option value="">اختر السنة</option>
                  </select>
                </div>

                <button class="btn" id="mobileApplyVehicle" style="width: 100%; margin-top: 16px;" disabled>
                  تطبيق فلتر المركبة
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Other filter sections (Brand, Category, Price, Stock) remain the same -->
        <div class="filter-section">
          <button class="section-title" data-section="brand">
            الماركة
            <svg class="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M9.00019 8.49997C8.86858 8.50073 8.73812 8.4755 8.61628 8.42574C8.49444 8.37597 8.38363 8.30265 8.29019 8.20997L6.00019 5.90997L3.71019 8.20997C3.52188 8.39827 3.26649 8.50406 3.00019 8.50406C2.73388 8.50406 2.47849 8.39827 2.29019 8.20997C2.10188 8.02166 1.99609 7.76627 1.99609 7.49997C1.99609 7.23366 2.10188 6.97827 2.29019 6.78997L6.00019 3.08997L9.71019 6.78997C9.80391 6.88293 9.87831 6.99353 9.92908 7.11539C9.97985 7.23725 10.006 7.36795 10.006 7.49997C10.006 7.63198 9.97985 7.76268 9.92908 7.88454C9.87831 8.0064 9.80391 8.117 9.71019 8.20997C9.61675 8.30265 9.50593 8.37597 9.38409 8.42574C9.26225 8.4755 9.13179 8.50073 9.00019 8.49997Z"></path>
            </svg>
          </button>
          <div class="section-body" id="brandSection">
            <div class="filter-options">
              <button class="filter-pill active" data-filter-type="brand" data-filter-value="all">كل الماركات</button>
            </div>
          </div>
        </div>

        <div class="filter-section">
          <button class="section-title" data-section="category">
            الفئة
            <svg class="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M9.00019 8.49997C8.86858 8.50073 8.73812 8.4755 8.61628 8.42574C8.49444 8.37597 8.38363 8.30265 8.29019 8.20997L6.00019 5.90997L3.71019 8.20997C3.52188 8.39827 3.26649 8.50406 3.00019 8.50406C2.73388 8.50406 2.47849 8.39827 2.29019 8.20997C2.10188 8.02166 1.99609 7.76627 1.99609 7.49997C1.99609 7.23366 2.10188 6.97827 2.29019 6.78997L6.00019 3.08997L9.71019 6.78997C9.80391 6.88293 9.87831 6.99353 9.92908 7.11539C9.97985 7.23725 10.006 7.36795 10.006 7.49997C10.006 7.63198 9.97985 7.76268 9.92908 7.88454C9.87831 8.0064 9.80391 8.117 9.71019 8.20997C9.61675 8.30265 9.50593 8.37597 9.38409 8.42574C9.26225 8.4755 9.13179 8.50073 9.00019 8.49997Z"></path>
            </svg>
          </button>
          <div class="section-body" id="categorySection">
            <div class="filter-options">
              <button class="filter-pill active" data-filter-type="category" data-filter-value="all">كل الفئات</button>
            </div>
          </div>
        </div>

        <div class="filter-section">
          <button class="section-title" data-section="price">
            نطاق السعر
            <svg class="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M9.00019 8.49997C8.86858 8.50073 8.73812 8.4755 8.61628 8.42574C8.49444 8.37597 8.38363 8.30265 8.29019 8.20997L6.00019 5.90997L3.71019 8.20997C3.52188 8.39827 3.26649 8.50406 3.00019 8.50406C2.73388 8.50406 2.47849 8.39827 2.29019 8.20997C2.10188 8.02166 1.99609 7.76627 1.99609 7.49997C1.99609 7.23366 2.10188 6.97827 2.29019 6.78997L6.00019 3.08997L9.71019 6.78997C9.80391 6.88293 9.87831 6.99353 9.92908 7.11539C9.97985 7.23725 10.006 7.36795 10.006 7.49997C10.006 7.63198 9.97985 7.76268 9.92908 7.88454C9.87831 8.0064 9.80391 8.117 9.71019 8.20997C9.61675 8.30265 9.50593 8.37597 9.38409 8.42574C9.26225 8.4755 9.13179 8.50073 9.00019 8.49997Z"></path>
            </svg>
          </button>
          <div class="section-body" id="priceSection">
            <div class="filter-options" id="price-filters">
              <!-- Price content will be populated -->
            </div>
          </div>
        </div>

        <div class="filter-section">
          <button class="section-title" data-section="stock">
            التوفر
            <svg class="chevron" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
              <path d="M9.00019 8.49997C8.86858 8.50073 8.73812 8.4755 8.61628 8.42574C8.49444 8.37597 8.38363 8.30265 8.29019 8.20997L6.00019 5.90997L3.71019 8.20997C3.52188 8.39827 3.26649 8.50406 3.00019 8.50406C2.73388 8.50406 2.47849 8.39827 2.29019 8.20997C2.10188 8.02166 1.99609 7.76627 1.99609 7.49997C1.99609 7.23366 2.10188 6.97827 2.29019 6.78997L6.00019 3.08997L9.71019 6.78997C9.80391 6.88293 9.87831 6.99353 9.92908 7.11539C9.97985 7.23725 10.006 7.36795 10.006 7.49997C10.006 7.63198 9.97985 7.76268 9.92908 7.88454C9.87831 8.0064 9.80391 8.117 9.71019 8.20997C9.61675 8.30265 9.50593 8.37597 9.38409 8.42574C9.26225 8.4755 9.13179 8.50073 9.00019 8.49997Z"></path>
            </svg>
          </button>
          <div class="section-body" id="stockSection">
            <div class="filter-options">
              <button class="filter-pill active" data-filter-type="stock" data-filter-value="all">أي مخزون</button>
              <button class="filter-pill" data-filter-type="stock" data-filter-value="true">متوفر</button>
              <button class="filter-pill" data-filter-type="stock" data-filter-value="false">غير متوفر</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="filter-footer">
        <button class="btn secondary" id="mobileClearFilters">
          مسح الكل
        </button>
        <button class="btn" id="mobileApplyFilters">
          عرض النتائج
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Sort Bottom Sheet -->
  <div class="mobile-sort-sheet" id="mobileSortSheet">
    <div class="sort-overlay" id="sortOverlay"></div>
    <div class="sort-sheet-content">
      <div class="sort-header">
        <h3 style="margin: 0;">ترتيب حسب</h3>
        <button class="sort-close" id="sortClose">
          <i style="font-size: 20px;">×</i>
        </button>
      </div>
      <div class="sort-options">
        <button class="sort-option active" data-sort-value="relevance">الأكثر صلة</button>
        <button class="sort-option" data-sort-value="price-low">السعر: من الأقل للأعلى</button>
        <button class="sort-option" data-sort-value="price-high">السعر: من الأعلى للأقل</button>
        <button class="sort-option" data-sort-value="newest">الأحدث</button>
        <button class="sort-option" data-sort-value="name">الاسم: من أ إلى ي</button>
      </div>
    </div>
  </div>



  <style>
  /* Mobile Filter Sheet Styles */
  .mobile-filter-sheet {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: none;
  }

  .mobile-filter-sheet.active {
      display: block;
  }

  .filter-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
  }

  .filter-sheet-content {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      border-radius: 16px 16px 0 0;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
  }

  .filter-header {
      padding: 16px;
      border-bottom: 1px solid var(--w1);
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .filter-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
  }

  .filter-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
  }

  .filter-footer {
      padding: 16px;
      border-top: 1px solid var(--w1);
      display: flex;
      gap: 12px;
  }

  .filter-footer .btn {
      flex: 1;
  }

  /* Mobile Sort Sheet Styles */
  .mobile-sort-sheet {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1001;
      display: none;
  }

  .mobile-sort-sheet.active {
      display: block;
  }

  .sort-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
  }

  .sort-sheet-content {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      border-radius: 16px 16px 0 0;
      max-height: 60vh;
  }

  .sort-header {
      padding: 16px;
      border-bottom: 1px solid var(--w1);
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .sort-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
  }

  .sort-options {
      padding: 8px 0;
  }

  .sort-option {
      width: 100%;
      padding: 16px;
      background: none;
      border: none;
      text-align: right;
      font-size: 16px;
      cursor: pointer;
      border-bottom: 1px solid var(--w2);
  }

  .sort-option.active {
      color: var(--red);
      font-weight: 500;
  }

  .sort-option:last-child {
      border-bottom: none;
  }

  /* Responsive styles */
  @media (max-width: 768px) {
      .mobile-search-sort {
          display: block !important;
      }

      .mobile-controls-row {
          width: 100%;
      }

      .search-trigger {
          transition: all 0.2s ease;
      }

      .search-trigger:active {
          background: var(--w3);
      }
  }

  @media (min-width: 769px) {
      .mobile-search-sort {
          display: none !important;
      }
  }

  /* Filter section styles */
  .filter-section {
      border-bottom: 1px solid var(--w2);
      margin-bottom: 16px;
  }

  .section-title {
      width: 100%;
      padding: 12px 0;
      background: none;
      border: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
  }

  .section-body {
      display: none;
      padding-bottom: 16px;
  }

  .section-body[style*="display: block"] {
      display: block !important;
  }

  .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
  }

  .filter-pill {
      padding: 8px 16px;
      border: 1px solid var(--w1);
      border-radius: 20px;
      background: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
  }

  .filter-pill.active {
      background: var(--red);
      color: white;
      border-color: var(--red);
  }

  .filter-pill:hover {
      border-color: var(--red);
  }

  /* Loading skeleton styles */
  .loading-skeleton .loading {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 4px;
      color: transparent;
  }

  .loading-skeleton .image.loading {
      min-height: 200px;
  }

  @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
  }

  body.filter-sheet-open,
  body.sort-sheet-open {
      overflow: hidden;
  }
  </style>
</body>
</html>