<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ - Ø§Ù„Ø³Ø§Ø¬ÙŠ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="css/style-ar.css">
</head>
<body>
  <script src="../data/static_api.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/cart-manager.js"></script>
  <script src="../js/layout.js"></script>



  <main class="wrap" style="text-align:center;padding:60px 20px">
    <div style="max-width:500px;margin:0 auto">
      <div style="font-size:64px;margin-bottom:20px">âœ…</div>
      <h1 style="margin-bottom:12px;color:var(--green)">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨!</h1>
      <p class="muted" style="margin-bottom:24px">
        Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ. Ù„Ù‚Ø¯ Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ø·Ù„Ø¨Ùƒ ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.
      </p>

      <div class="card" style="text-align:right;margin-bottom:24px">
        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h3>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</div>
          <div id="orderNumber" style="font-weight:600;color:var(--primary)"></div>
        </div>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</div>
          <div id="orderDate"></div>
        </div>
        <div class="row between" style="margin-bottom:12px">
          <div class="muted">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</div>
          <div style="color:var(--green);font-weight:500">2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</div>
        </div>
        <div class="row between">
          <div class="muted">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</div>
          <div id="orderTotal" style="font-weight:600;color:var(--red)"></div>
        </div>
      </div>

      <div class="card" style="text-align:right;margin-bottom:24px;background:var(--w2)">
        <h4 style="margin-bottom:12px">Ù…Ø§Ø°Ø§ Ø¨Ø¹Ø¯ØŸ</h4>
        <div style="display:flex;gap:12px;align-items:flex-start;margin-bottom:12px">
          <div style="background:var(--green);color:white;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">1</div>
          <div>
            <div style="font-weight:500">Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨</div>
            <div class="muted" style="font-size:14px">Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¶ÙŠØ± Ø¹Ù†Ø§ØµØ±Ùƒ Ù„Ù„Ø´Ø­Ù†</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start;margin-bottom:12px">
          <div style="background:var(--w3);color:var(--text);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">2</div>
          <div>
            <div style="font-weight:500">Ø§Ù„Ø´Ø­Ù†</div>
            <div class="muted" style="font-size:14px">Ø³ÙŠØªÙ… Ø´Ø­Ù† Ø·Ù„Ø¨Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:flex-start">
          <div style="background:var(--w3);color:var(--text);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0">3</div>
          <div>
            <div style="font-weight:500">Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
            <div class="muted" style="font-size:14px">Ø³ÙˆÙ ØªØ³ØªÙ„Ù… Ø·Ù„Ø¨Ùƒ Ø®Ù„Ø§Ù„ 2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <a href="shop.html" class="btn">Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</a>
        <a href="index.html" class="btn secondary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <button class="btn secondary" onclick="printOrder()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
      </div>

      <div style="margin-top:32px;padding:16px;background:var(--w2);border-radius:8px;">
        <p class="muted" style="margin:0;font-size:14px">
          ØªØ­ØªØ§Ø¬ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ <a href="support.html" style="color:var(--primary)">Ø§ØªØµÙ„ Ø¨ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…</a> Ø£Ùˆ Ø§ØªØµÙ„ Ø¨Ù†Ø§ Ø¹Ù„Ù‰ <strong>+964 123 456 7890</strong>
        </p>
      </div>
    </div>
  </main>

  <script>
  // Language switching
  document.getElementById('langSwitch').addEventListener('click', function() {
    window.location.href = '../order-confirmed.html';
  });

  class OrderConfirmation {
      constructor() {
          this.init();
      }

      init() {
          console.log('âœ… ØªÙ‡ÙŠØ¦Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨...');
          this.loadOrderDetails();
          this.updateCartCount();
          this.saveOrderToHistory();
      }

    // In order-confirmed.html, add this to loadOrderDetails method:
loadOrderDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const orderId = urlParams.get('order');
    const total = urlParams.get('total');
    const odooId = urlParams.get('odoo_id');

    // Set order number
    document.getElementById('orderNumber').textContent = orderId;

    // ğŸ”¥ SET ORDER DATE (current date)
    const orderDate = new Date();
    const formattedDate = orderDate.toLocaleDateString('ar-IQ', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
    });

    // Find or create order date element
    let orderDateElement = document.getElementById('orderDate');
    if (!orderDateElement) {
        // If element doesn't exist, create it
        const orderNumberElement = document.getElementById('orderNumber');
        if (orderNumberElement && orderNumberElement.parentNode) {
            orderDateElement = document.createElement('div');
            orderDateElement.id = 'orderDate';
            orderDateElement.className = 'order-date';
            orderDateElement.style.marginTop = '8px';
            orderDateElement.style.color = 'var(--muted)';
            orderNumberElement.parentNode.insertBefore(orderDateElement, orderNumberElement.nextSibling);
        }
    }
    if (orderDateElement) {
        orderDateElement.textContent = `${formattedDate}`;
    }

    // ğŸ”¥ SET TOTAL AMOUNT
    if (total) {
        // Find or create total amount element
        let totalElement = document.getElementById('orderTotal');
        if (!totalElement) {
            const orderNumberElement = document.getElementById('orderNumber');
            if (orderNumberElement && orderNumberElement.parentNode) {
                totalElement = document.createElement('div');
                totalElement.id = 'orderTotal';
                totalElement.className = 'order-total';
                totalElement.style.marginTop = '8px';
                totalElement.style.fontSize = '1.2em';
                totalElement.style.fontWeight = 'bold';
                totalElement.style.color = 'var(--red)';
                const orderDateEl = document.getElementById('orderDate');
                if (orderDateEl) {
                    orderDateEl.parentNode.insertBefore(totalElement, orderDateEl.nextSibling);
                } else {
                    orderNumberElement.parentNode.insertBefore(totalElement, orderNumberElement.nextSibling);
                }
            }
        }
        if (totalElement) {
            totalElement.textContent = ` Ø¯ÙŠÙ†Ø§Ø± ${parseInt(total).toLocaleString()}`;
        }
    }

    // Show Odoo status if available
    if (odooId && odooId !== 'manual') {
        console.log(`âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Odoo Ø¨Ø§Ù„Ø±Ù‚Ù…: ${odooId}`);
        // You can add Odoo status display here if needed
    }

}

      saveOrderToHistory() {
          // Save order to order history
          const orderNumber = document.getElementById('orderNumber').textContent;
          const orderTotal = document.getElementById('orderTotal').textContent;

          const orderData = {
              id: orderNumber,
              date: new Date().toISOString(),
              total: this.extractAmount(orderTotal),
              status: 'confirmed'
          };

          // Save to localStorage
          localStorage.setItem('alsaji_last_order', JSON.stringify(orderData));

          // Add to order history
          let orderHistory = JSON.parse(localStorage.getItem('alsaji_order_history') || '[]');
          orderHistory.unshift(orderData);
          localStorage.setItem('alsaji_order_history', JSON.stringify(orderHistory.slice(0, 10))); // Keep last 10 orders
      }

      extractAmount(amountText) {
          // Extract numeric value from "Ø¯ÙŠÙ†Ø§Ø± 1,234" format
          const match = amountText.match(/Ø¯ÙŠÙ†Ø§Ø±\s*([\d,]+)/);
          if (match) {
              return parseInt(match[1].replace(/,/g, ''));
          }
          return 0;
      }

      async updateCartCount() {
          try {
              // Reset cart count to 0 since order is confirmed
              const cartCountElement = document.getElementById('cartCount');
              if (cartCountElement) {
                  cartCountElement.textContent = '0';
              }

              // Also clear the cart in localStorage to be sure
              localStorage.removeItem('alsaji_cart');

          } catch (error) {
              console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±:', error);
          }
      }
  }

  function printOrder() {
      const orderContent = `
          <div style="font-family: Arial, sans-serif; padding: 20px; max-width: 500px; margin: 0 auto; direction: rtl; text-align: right;">
              <div style="text-align: center; margin-bottom: 20px;">
                  <h1 style="color: #2c5aa0; margin-bottom: 8px;">Ø§Ù„Ø³Ø§Ø¬ÙŠ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
                  <p style="color: #666; margin: 0;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</p>
              </div>

              <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong>
                      <span>${document.getElementById('orderNumber').textContent}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</strong>
                      <span>${document.getElementById('orderDate').textContent}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                      <strong>Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong>
                      <span>2-3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 18px;">
                      <strong>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong>
                      <span style="color: #dc3545;">${document.getElementById('orderTotal').textContent}</span>
                  </div>
              </div>

              <div style="text-align: center; color: #666; font-size: 14px;">
                  <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ!</p>
                  <p>Ø§Ù„Ø³Ø§Ø¬ÙŠ Ù„Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª - Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø©ØŒ Ø®Ø¯Ù…Ø© Ù…ÙˆØ«ÙˆÙ‚Ø©</p>
              </div>
          </div>
      `;

      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
          <html>
              <head>
                  <title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ - ${document.getElementById('orderNumber').textContent}</title>
                  <style>
                      body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
                      @media print {
                          body { margin: 0; }
                      }
                  </style>
              </head>
              <body>${orderContent}</body>
          </html>
      `);
      printWindow.document.close();
      printWindow.focus();

      setTimeout(() => {
          printWindow.print();
          printWindow.close();
      }, 250);
  }

  // Initialize order confirmation
  document.addEventListener('DOMContentLoaded', () => {
      new OrderConfirmation();
  });
  </script>

</body>
</html>